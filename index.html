<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkyHouse - Магазин бытовой техники и электроники</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
   <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <a href="/">SkyHouse</a>
            </div>
            <nav>
                <ul>
                    <li><a href="catalog.html">Каталог</a></li>
                    <li><a href="#about">О нас</a></li>
                    <li><a href="#delivery">Доставка и оплата</a></li>
                    <li><a href="#contacts">Контакты</a></li>
                </ul>
            </nav>
            <div class="header-right">
                <div class="auth">
                    <a href="#" onclick="openLoginModal()">Вход</a>
                    <a href="#" onclick="openRegisterModal()">Регистрация</a>
                </div>
                <div class="search">
                    <input type="text" placeholder="Поиск...">
                    <button>Найти</button>
                </div>
                <div class="cart-icon" onclick="openCartModal()">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count" id="cart-item-count">0</span>
                </div>
            </div>
        </div>
    </header>

    <main>
       <section class="categories" id="categories">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">Популярные категории</h2>
            <div class="section-divider"></div>
            <p class="section-subtitle">Лучшие предложения для вашего дома</p>
        </div>
        
        <div class="category-grid">
            <div class="category-item">
                <div class="category-image">
                    <img src="images/holodilniki.main.jpg" alt="Холодильники">
                </div>
                <div class="category-content">
                    <h3>Холодильники</h3>
                    <a href="catalog.html?category=refrigerators" class="category-link">Смотреть все</a>
                </div>
            </div>
            
            <div class="category-item">
                <div class="category-image">
                    <img src="images/stiralka.main.jpg" alt="Стиральные машины">
                </div>
                <div class="category-content">
                    <h3>Стиральные машины</h3>
                    <a href="catalog.html?category=washing_machines" class="category-link">Смотреть все</a>
                </div>
            </div>
            
            <div class="category-item">
                <div class="category-image">
                    <img src="images/televizors.main.jpg" alt="Телевизоры">
                </div>
                <div class="category-content">
                    <h3>Телевизоры</h3>
                    <a href="catalog.html?category=televisions" class="category-link">Смотреть все</a>
                </div>
            </div>
            
            <div class="category-item">
                <div class="category-image">
                    <img src="images/nout.main.jpg" alt="Ноутбуки">
                </div>
                <div class="category-content">
                    <h3>Ноутбуки</h3>
                    <a href="catalog.html?category=laptops" class="category-link">Смотреть все</a>
                </div>
            </div>
        </div>
    </div>
</section>
        <div class="section-header">
    <h2 class="section-title">О нас</h2>
    <div class="section-divider"></div>
                <div class="about-content">
                    <div class="about-text">
                        <h3>SkyHouse - ваш надежный партнер в мире техники</h3>
                        <p>Мы предлагаем нашим клиентам только качественную продукцию от проверенных мировых производителей.</p>
                        <p>Наш магазин специализируется на продаже холодильников, стиральных машин, телевизоров, ноутбуков и другой техники для дома. Мы тщательно отбираем ассортимент, чтобы предложить вам лучшее сочетание цены и качества.</p>
                        
                    </div>
                    <div class="about-image">
                        <img src="images/mi.jpg" alt="Магазин SkyHouse">
                    </div>
                </div>
            </div>
        </section>

       <section class="advantages" id="advantages">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">Наши преимущества</h2>
            <div class="section-divider"></div>
            <p class="section-subtitle">Почему клиенты выбирают именно нас</p>
        </div>
        <div class="advantage-grid">
            <div class="advantage-item">
                <div class="advantage-image">
                    <img src="images/assort.png" alt="Широкий ассортимент">
                </div>
                <h3>Широкий ассортимент</h3>
                <p>Более 10 000 товаров от ведущих производителей.</p>
            </div>
            <div class="advantage-item">
                <div class="advantage-image">
                    <img src="images/price.png" alt="Лучшие цены">
                </div>
                <h3>Лучшие цены</h3>
                <p>Регулярные акции и скидки для наших клиентов.</p>
            </div>
            <div class="advantage-item">
                <div class="advantage-image">
                    <img src="images/dost.jpg" alt="Быстрая доставка">
                </div>
                <h3>Быстрая доставка</h3>
                <p>Доставка по всей России в кратчайшие сроки.</p>
            </div>
            <div class="advantage-item">
                <div class="advantage-image">
                    <img src="images/garant.png" alt="Гарантия качества">
                </div>
                <h3>Гарантия качества</h3>
                <p>Все товары сертифицированы и имеют официальную гарантию.</p>
            </div>
        </div>
    </div>
</section>
    </main>
    <section class="contact-form">
    <div class="section-header">
        <h2 class="section-title">Форма обратной связи</h2>
        <div class="section-divider"></div>
        <p class="section-subtitle">Оставьте ваши вопросы и пожелания</p>
    </div>
    
    <form id="feedbackForm">
        <div class="form-group">
            <label for="firstName">Имя:</label>
            <input type="text" id="firstName" name="firstName" required>
        </div>
        <div class="form-group">
            <label for="lastName">Фамилия:</label>
            <input type="text" id="lastName" name="lastName" required>
        </div>
        <div class="form-group">
            <label for="email">Электронная почта:</label>
            <input type="email" id="email" name="email" required>
        </div>
        <div class="form-group">
            <label for="message">Ваш вопрос:</label>
            <textarea id="message" name="message" required></textarea>
        </div>
        <div class="form-group text-center">
            <button type="submit" class="submit-btn">Отправить</button>
        </div>
        <div id="successMessage" class="success-message">
            Ваше письмо успешно отправлено! Мы свяжемся с вами в ближайшее время.
        </div>
    </form>
</section>
    
    <script>
        document.getElementById('feedbackForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Здесь можно добавить код для отправки данных на сервер
            // Например, с помощью fetch или XMLHttpRequest
            
            // Показываем сообщение об успешной отправке
            document.getElementById('successMessage').style.display = 'block';
            
            // Очищаем форму
            this.reset();
            
            // Скрываем сообщение через 5 секунд
            setTimeout(function() {
                document.getElementById('successMessage').style.display = 'none';
            }, 5000);
        });
    </script>
    <footer>
        <div class="container">
            <div class="footer-info">
                <p>&copy; 2025 SkyHouse. Все права защищены.</p>
                <p>Служба поддержки: <a href="mailto:support@technoshop.ru">support@SkyHouse.ru</a></p>
                <p>Телефон: <a href="tel:+74951234567">+7 (495) 123-45-67</a></p>
            </div>
            <div class="footer-links">
                <a href="terms.html">Условия использования</a> |
                <a id ="privacyBtn">Политика конфиденциальности</a> |
                <a href="sitemap.html">Карта сайта</a>
            </div>
            <div class="social-icons">
                <a href="https://t.me/+165OTN2sXiw2NzNi" target="_blank"><img src="images/tg.png" alt="Telegram"></a>
                <a href="https://vk.com/club230780968" target="_blank"><img src="images/vk.jpg" alt="VK"></a>
                <a href="https://chat.whatsapp.com/E7eZco3vlej7R0Zr6gHEP4" target="_blank"><img src="images/wt.png" alt="Whatsapp"></a>
            </div>
        </div>
    </footer>

    <!-- Модальное окно входа -->
<div id="loginModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeLoginModal()">&times;</span>
        <h2>Вход</h2>
        <form action="#" method="post">
            <label for="login-email">Email:</label>
            <input type="email" id="login-email" name="email" required>

            <label for="login-password">Пароль:</label>
            <input type="password" id="login-password" name="password" required>

            <button type="submit">Войти</button>
        </form>
    </div>
</div>

    <!-- Модальное окно регистрации -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeRegisterModal()">&times;</span>
            <h2>Регистрация</h2>
            <form action="#" method="post">
                <label for="name">Имя:</label>
                <input type="text" id="name" name="name" required>

                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>

                <label for="password">Пароль:</label>
                <input type="password" id="password" name="password" required>

                <label for="password_confirm">Подтвердите пароль:</label>
                <input type="password" id="password_confirm" name="password_confirm" required>

                <button type="submit">Зарегистрироваться</button>
            </form>
        </div>
    </div>

    <!-- Модальное окно корзины -->
    <div id="cartModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCartModal()">&times;</span>
            <h2>Корзина</h2>
            <div class="cart-items" id="cart-items-container">
                <!-- Здесь будет содержимое корзины -->
                <p>Ваша корзина пуста.</p>
            </div>
            <div class="cart-total">
                Итого: <span id="cart-total-price">0</span> ₽
            </div>
            
            <!-- Блок выбора способа оплаты -->
            <div class="payment-methods" id="payment-methods">
                <h3>Способ оплаты</h3>
                <div class="payment-options">
                    <div class="payment-option" data-method="visa" onclick="selectPaymentMethod('visa')">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/Visa_Inc._logo.svg/2560px-Visa_Inc._logo.svg.png" alt="Visa">
                        <p>Visa</p>
                    </div>
                    <div class="payment-option" data-method="mastercard" onclick="selectPaymentMethod('mastercard')">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/Mastercard-logo.svg/1280px-Mastercard-logo.svg.png" alt="Mastercard">
                        <p>Mastercard</p>
                    </div>
                    <div class="payment-option" data-method="mir" onclick="selectPaymentMethod('mir')">
                        <img src="https://nklk.ru/dll_image/3213.png" alt="Мир">
                        <p>Мир</p>
                    </div>
                    <div class="payment-option" data-method="sbp" onclick="selectPaymentMethod('sbp')">
                        <img src="https://www.depotwpf.ru/upload/resize_cache/iblock/4dc/1500_949_1/4dcd6ddc73d8e4db662a9ef61757edde.png" alt="СБП">
                        <p>СБП</p>
                    </div>
                </div>
                
                <!-- Форма для оплаты картой -->
                <div class="payment-form" id="card-payment-form">
                    <div class="form-group">
                        <label for="card-number">Номер карты</label>
                        <input type="text" id="card-number" placeholder="1234 5678 9012 3456" maxlength="19">
                    </div>
                    <div class="form-group">
                        <label for="card-name">Имя владельца</label>
                        <input type="text" id="card-name" placeholder="IVAN IVANOV">
                    </div>
                    <div class="payment-form-row">
                        <div class="form-group">
                            <label for="card-expiry">Срок действия</label>
                            <input type="text" id="card-expiry" placeholder="MM/YY" maxlength="5">
                        </div>
                        <div class="form-group">
                            <label for="card-cvv">CVV/CVC</label>
                            <input type="text" id="card-cvv" placeholder="123" maxlength="3">
                        </div>
                    </div>
                    <button type="button" onclick="processPayment()">Оплатить</button>
                </div>
                
                <!-- Форма для СБП -->
                <div class="payment-form" id="sbp-payment-form">
                    <p>Для оплаты через Систему Быстрых Платежей отсканируйте QR-код или нажмите кнопку ниже:</p>
                    <div style="text-align: center; margin: 20px 0;">
                        <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://technoshop.ru/payment/12345" alt="QR код для оплаты" style="width: 150px; height: 150px;">
                    </div>
                    <button type="button" onclick="processSBPPayment()">Я оплатил</button>
                </div>
                
                <!-- Сообщение об успешной оплате -->
                <div class="payment-success" id="payment-success">
                    <i class="fas fa-check-circle"></i>
                    <h3>Оплата прошла успешно!</h3>
                    <p>Спасибо за ваш заказ. Номер вашего заказа: #<span id="order-number">12345</span></p>
                    <p>Мы отправили детали заказа на вашу электронную почту.</p>
                    <button onclick="closeCartModal()">Вернуться в магазин</button>
                </div>
            </div>
            
            <button id="checkout-btn" onclick="showPaymentMethods()" style="display: none;">Перейти к оплате</button>
        </div>
    </div>

    <script>
        // JavaScript для работы с корзиной
        let cart = [];
        let selectedPaymentMethod = null;
        
        // Функция для обновления количества товаров в корзине
        function updateCartCount() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cart-item-count').textContent = totalItems;
        }
        
        // Функция для обновления содержимого корзины в модальном окне
        function updateCartModal() {
            const container = document.getElementById('cart-items-container');
            const checkoutBtn = document.getElementById('checkout-btn');
            
            if (cart.length === 0) {
                container.innerHTML = '<p>Ваша корзина пуста.</p>';
                document.getElementById('cart-total-price').textContent = '0';
                checkoutBtn.style.display = 'none';
                document.getElementById('payment-methods').style.display = 'none';
                return;
            }
            
            let html = '';
            let totalPrice = 0;
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                totalPrice += itemTotal;
                
                html += `
                    <div class="cart-item">
                        <img src="${item.image}" alt="${item.name}">
                        <div class="cart-item-info">
                            <div class="cart-item-title">${item.name}</div>
                            <div>${item.quantity} × ${item.price} ₽</div>
                        </div>
                        <div class="cart-item-price">${itemTotal} ₽</div>
                        <div class="cart-item-remove" onclick="removeFromCart(${item.id})">&times;</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            document.getElementById('cart-total-price').textContent = totalPrice;
            checkoutBtn.style.display = 'block';
            document.getElementById('payment-methods').style.display = 'none';
        }
        
        // Функция для добавления товара в корзину (для демонстрации)
        function addToCart(product) {
            const existingItem = cart.find(item => item.id === product.id);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    ...product,
                    quantity: 1
                });
            }
            
            updateCartCount();
            updateCartModal();
        }
        
        // Функция для удаления товара из корзины
        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCartCount();
            updateCartModal();
        }
        
        // Функция показа методов оплаты
        function showPaymentMethods() {
            document.getElementById('payment-methods').style.display = 'block';
            document.getElementById('checkout-btn').style.display = 'none';
        }
        
        // Функция выбора метода оплаты
        function selectPaymentMethod(method) {
            selectedPaymentMethod = method;
            
            // Убираем выделение со всех методов
            document.querySelectorAll('.payment-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Добавляем выделение выбранному методу
            document.querySelector(`.payment-option[data-method="${method}"]`).classList.add('selected');
            
            // Показываем соответствующую форму оплаты
            document.querySelectorAll('.payment-form').forEach(form => {
                form.classList.remove('active');
            });
            
            if (method === 'sbp') {
                document.getElementById('sbp-payment-form').classList.add('active');
            } else {
                document.getElementById('card-payment-form').classList.add('active');
            }
        }
        
        // Функция обработки платежа
        function processPayment() {
            // Валидация формы
            const cardNumber = document.getElementById('card-number').value;
            const cardName = document.getElementById('card-name').value;
            const cardExpiry = document.getElementById('card-expiry').value;
            const cardCvv = document.getElementById('card-cvv').value;
            
            if (!cardNumber || !cardName || !cardExpiry || !cardCvv) {
                alert('Пожалуйста, заполните все поля!');
                return;
            }
            
            // Имитация обработки платежа
            setTimeout(() => {
                showPaymentSuccess();
            }, 1500);
        }
        
        // Функция обработки платежа через СБП
        function processSBPPayment() {
            // Имитация обработки платежа
            setTimeout(() => {
                showPaymentSuccess();
            }, 1500);
        }
        
        // Функция показа сообщения об успешной оплате
        function showPaymentSuccess() {
            // Генерируем случайный номер заказа
            const orderNumber = Math.floor(10000 + Math.random() * 90000);
            document.getElementById('order-number').textContent = orderNumber;
            
            // Скрываем формы оплаты и показываем сообщение об успехе
            document.querySelectorAll('.payment-form').forEach(form => {
                form.classList.remove('active');
            });
            document.getElementById('payment-success').style.display = 'block';
            
            // Очищаем корзину
            cart = [];
            updateCartCount();
        }
         // Функция для обработки формы обратной связи
         function submitFeedbackForm(event) {
            event.preventDefault();
            
            // Получаем данные из формы
            const firstName = document.getElementById('first-name').value;
            const lastName = document.getElementById('last-name').value;
            const email = document.getElementById('email').value;
            const message = document.getElementById('message').value;
            
            // Здесь можно добавить код для отправки данных на сервер
            // Для демонстрации просто покажем сообщение об успехе
            
            // Показываем сообщение об успешной отправке
            document.getElementById('feedback-form').style.display = 'none';
            document.getElementById('form-success').style.display = 'block';
            
            // Прокручиваем страницу к сообщению об успехе
            document.getElementById('form-success').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Функция для сброса формы обратной связи
        function resetFeedbackForm() {
            // Сбрасываем форму
            document.getElementById('feedback-form').reset();
            
            // Показываем форму и скрываем сообщение об успехе
            document.getElementById('feedback-form').style.display = 'block';
            document.getElementById('form-success').style.display = 'none';
            
            // Прокручиваем страницу к форме
            document.getElementById('contact-form').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Для демонстрации - добавляем несколько товаров
        const demoProducts = [
            { id: 1, name: 'Холодильник BOSCH', price: 45990, image: 'images/bosh.jpg' },
            { id: 2, name: 'Стиральная машина LG', price: 32990, image: 'images/category_washing_machines.jpg' },
            { id: 3, name: 'Телевизор Samsung', price: 59990, image: 'images/category_televisions.jpg' }
        ];
        
        // Добавляем обработчик для демонстрации добавления товаров
        document.addEventListener('DOMContentLoaded', () => {
            // Можно добавить обработчики на кнопки "В корзину" в каталоге
            // Для демонстрации добавим 1 товар
            addToCart(demoProducts[0]);
        });

        // JavaScript для открытия и закрытия модальных окон
        var loginModal = document.getElementById("loginModal");
        var registerModal = document.getElementById("registerModal");
        var cartModal = document.getElementById("cartModal");

        function openLoginModal() {
            loginModal.style.display = "block";
        }

        function closeLoginModal() {
            loginModal.style.display = "none";
        }

        function openRegisterModal() {
            registerModal.style.display = "block";
        }

        function closeRegisterModal() {
            registerModal.style.display = "none";
        }

        function openCartModal() {
            cartModal.style.display = "block";
            updateCartModal();
        }

        function closeCartModal() {
            cartModal.style.display = "none";
            // Сбрасываем состояние оплаты при закрытии корзины
            document.getElementById('payment-success').style.display = 'none';
            document.querySelectorAll('.payment-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelectorAll('.payment-form').forEach(form => {
                form.classList.remove('active');
            });
            document.getElementById('payment-methods').style.display = 'none';
            document.getElementById('checkout-btn').style.display = 'block';
        }

        // Закрытие модального окна при клике вне его области
        window.onclick = function(event) {
            if (event.target == loginModal) {
                closeLoginModal();
            }
            if (event.target == registerModal) {
                closeRegisterModal();
            }
            if (event.target == cartModal) {
                closeCartModal();
            }
        }
        
        // Форматирование номера карты
        document.getElementById('card-number').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\s+/g, '');
            if (value.length > 0) {
                value = value.match(new RegExp('.{1,4}', 'g')).join(' ');
            }
            e.target.value = value;
        });
        
        // Форматирование срока действия карты
        document.getElementById('card-expiry').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 2) {
                value = value.substring(0, 2) + '/' + value.substring(2, 4);
            }
            e.target.value = value;
        });
    </script>
<!-- Кнопка для открытия политики конфиденциальности -->

<!-- Модальное окно с политикой конфиденциальности -->
<div id="privacyModal" class="modal">
    <div class="modal-content">
        <span class="close"onclick="closePrivacyModal()">&times;</span>
        <div class="privacy-content">
            <h1>Политика конфиденциальности интернет-магазина "SkyHouse"</h1>
            
            <p>Последнее обновление: 25 Апреля 2025 года</p>
            
            <h2>1. Общие положения</h2>
            <p>1.1. Интернет-магазин "SkyHouse" (далее - "Магазин") уважает ваше право на конфиденциальность и обязуется защищать персональные данные, которые вы предоставляете нам при использовании нашего сайта.</p>
            
            <h2>2. Какие данные мы собираем</h2>
            <p>2.1. При оформлении заказа мы можем запросить у вас следующую информацию:</p>
            <ul>
                <li>ФИО</li>
                <li>Контактный телефон</li>
                <li>Адрес электронной почты</li>
                <li>Адрес доставки</li>
                <li>Платежные реквизиты (для оформления покупки)</li>
            </ul>
            
            <h2>3. Как мы используем ваши данные</h2>
            <p>3.1. Мы используем ваши персональные данные для:</p>
            <ul>
                <li>Обработки и выполнения ваших заказов</li>
                <li>Обеспечения работы сервисов магазина</li>
                <li>Коммуникации с вами по вопросам заказов</li>
                <li>Улучшения качества обслуживания</li>
                <li>Отправки маркетинговых материалов (только с вашего согласия)</li>
            </ul>
            
            <h2>4. Защита данных</h2>
            <p>4.1. Мы принимаем все необходимые меры для защиты ваших персональных данных от несанкционированного доступа, изменения, раскрытия или уничтожения.</p>
            
            <h2>5. Передача данных третьим лицам</h2>
            <p>5.1. Мы не передаем ваши персональные данные третьим лицам, за исключением:</p>
            <ul>
                <li>Служб доставки (для выполнения заказа)</li>
                <li>Платежных систем (для обработки платежей)</li>
                <li>По требованию законодательства</li>
            </ul>
            
            <h2>6. Cookies и аналогичные технологии</h2>
            <p>6.1. Наш сайт использует cookies для:</p>
            <ul>
                <li>Запоминания ваших предпочтений</li>
                <li>Анализа посещаемости сайта</li>
                <li>Персонализации контента</li>
            </ul>
            
            <h2>7. Ваши права</h2>
            <p>7.1. Вы имеете право:</p>
            <ul>
                <li>Запросить доступ к вашим персональным данным</li>
                <li>Запросить исправление неточных данных</li>
                <li>Запросить удаление ваших данных</li>
                <li>Отозвать согласие на обработку данных</li>
            </ul>
            
            <h2>8. Контакты</h2>
            <p>8.1. По всем вопросам, связанным с обработкой персональных данных, вы можете обратиться:</p>
            <ul>
                <li>Email: privacy@technomir.ru</li>
                <li>Телефон: +7 (800) 123-45-67</li>
                <li>Почтовый адрес: 123456, г. Москва, ул. Техническая, д. 1</li>
            </ul>
            
            <p>8.2. Мы оставляем за собой право вносить изменения в настоящую Политику конфиденциальности. Актуальная версия всегда доступна на нашем сайте.</p>
        </div>
    </div>
</div>

<script>
    // Получаем элементы модального окна
    const modal = document.getElementById("privacyModal");
    const btn = document.getElementById("privacyBtn");
    const span = document.getElementsByClassName("close")[0];
    
    // Открываем модальное окно при клике на кнопку
    btn.onclick = function() {
        modal.style.display = "block";
    }
    
    // Закрываем модальное окно при клике на крестик
    span.onclick = function() {
        modal.style.display = "none";
    }
    
    // Закрываем модальное окно при клике вне его области
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
    
    // Закрываем модальное окно при нажатии Esc
    document.onkeydown = function(event) {
        if (event.key === "Escape") {
            modal.style.display = "none";
        }
    };
</script>
 <!-- Кнопка открытия чата -->
    <button class="chat-toggle" id="chatToggle">Онлайн-чат</button>
    
    <!-- Форма чата -->
    <div class="chat-form" id="chatForm">
        <div class="chat-header">
            <div class="operator-info">
                <img src="images/operator.jpg" alt="Оператор" class="operator-avatar">
                <span>Поддержка (Елена)</span>
            </div>
            <button class="close-btn" id="closeChat">×</button>
        </div>
        
        <div class="chat-body" id="chatBody">
            <div class="typing-indicator" id="typingIndicator">
                Елена печатает...
            </div>
            <script>
            function getCurrentTime() {
    const now = new Date();
    const hours = now.getHours().toString().padStart(2, '0');
    const minutes = now.getMinutes().toString().padStart(2, '0');
    return `${hours}:${minutes}`;
}    
            </script>
            <!-- Пример сообщения от оператора -->
            <div class="message operator-message">
                <div>Здравствуйте! Чем могу помочь?</div>
                <div class="message-time">10:30</div>
            </div>
        </div>
        
        <div class="chat-footer">
            <button class="file-btn" id="fileBtn" title="Отправить фото">📷</button>
            <input type="file" id="fileInput" class="file-input" accept="image/*">
            <input type="text" class="message-input" id="messageInput" placeholder="Напишите сообщение...">
            <button class="send-btn" id="sendBtn">→</button>
        </div>
    </div>

    <script>
        // Элементы интерфейса
        const chatToggle = document.getElementById('chatToggle');
        const chatForm = document.getElementById('chatForm');
        const closeChat = document.getElementById('closeChat');
        const chatBody = document.getElementById('chatBody');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const fileBtn = document.getElementById('fileBtn');
        const fileInput = document.getElementById('fileInput');
        const typingIndicator = document.getElementById('typingIndicator');
        
        // Переменные состояния
        let isChatOpen = false;
        
        // Открытие/закрытие чата
        chatToggle.addEventListener('click', toggleChat);
        closeChat.addEventListener('click', toggleChat);
        
        function toggleChat() {
            isChatOpen = !isChatOpen;
            
            if (isChatOpen) {
                chatForm.classList.add('active');
                messageInput.focus();
            } else {
                chatForm.classList.remove('active');
            }
        }
        
        // Отправка сообщения при нажатии Enter
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // Отправка сообщения при клике на кнопку
        sendBtn.addEventListener('click', sendMessage);
        
        // Открытие выбора файла
        fileBtn.addEventListener('click', () => {
            fileInput.click();
        });
        
        // Обработка выбора файла
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                sendImage(e.target.files[0]);
                e.target.value = '';
            }
        });
        
        // Функция отправки сообщения
        function sendMessage() {
            const messageText = messageInput.value.trim();
            if (messageText !== '') {
                addMessage(messageText, 'user');
                messageInput.value = '';
                
                // Имитация ответа оператора
                simulateOperatorResponse();
            }
        }
        
        // Функция отправки изображения
        function sendImage(file) {
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const messageDiv = document.createElement('div');
                    messageDiv.classList.add('message', 'user-message');
                    
                    const imgElement = document.createElement('img');
                    imgElement.src = e.target.result;
                    imgElement.classList.add('preview-image');
                    
                    const timeDiv = document.createElement('div');
                    timeDiv.classList.add('message-time');
                    timeDiv.textContent = getCurrentTime();
                    
                    messageDiv.appendChild(imgElement);
                    messageDiv.appendChild(timeDiv);
                    chatBody.appendChild(messageDiv);
                    
                    scrollToBottom();
                    
                    // Имитация ответа оператора
                    simulateOperatorResponse(true);
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Имитация ответа оператора
        function simulateOperatorResponse(isImage = false) {
            setTimeout(() => {
                typingIndicator.style.display = 'block';
                scrollToBottom();
                
                setTimeout(() => {
                    typingIndicator.style.display = 'none';
                    
                    const responses = isImage ? [
                        "Спасибо за фото, я его рассмотрю.",
                        "Я получил ваше изображение, спасибо!",
                        "Благодарю за предоставленное фото."
                    ] : [
                        "Конечно, я вам помогу!",
                        "Пожалуйста, уточните ваш вопрос.",
                        "Сейчас посмотрю информацию по вашему заказу."
                    ];
                    
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    addMessage(randomResponse, 'operator');
                }, 2000);
            }, 1000);
        }
        
        // Функция добавления сообщения
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', sender + '-message');
            
            const messageText = document.createElement('div');
            messageText.textContent = text;
            
            const timeDiv = document.createElement('div');
            timeDiv.classList.add('message-time');
            timeDiv.textContent = getCurrentTime();
            
            messageDiv.appendChild(messageText);
            messageDiv.appendChild(timeDiv);
            chatBody.appendChild(messageDiv);
            
            scrollToBottom();
        }
        
        // Функция прокрутки вниз
        function scrollToBottom() {
            chatBody.scrollTop = chatBody.scrollHeight;
        }
        
        // Функция получения текущего времени
        function getCurrentTime() {
            const now = new Date();
            return `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
        }
        
        // Автоматическое открытие через 30 секунд
        setTimeout(() => {
            if (!isChatOpen) {
                toggleChat();
                addMessage("Здравствуйте! Нужна помощь с выбором товара?", 'operator');
            }
        }, 30000);
    </script>
<!-- Добавьте этот код перед закрывающим тегом </body> -->
<button class="scroll-to-top" id="scrollToTopBtn" title="Наверх">
    <i class="fas fa-arrow-up"></i>
</button>

<script>
    // Кнопка "Наверх"
    const scrollToTopBtn = document.getElementById('scrollToTopBtn');
    // Показываем/скрываем кнопку при прокрутке
    window.addEventListener('scroll', function() {
        if (window.pageYOffset > 300) {
            scrollToTopBtn.style.display = 'flex';
        } else {
            scrollToTopBtn.style.display = 'none';
        }
        
        // Если чат открыт, скрываем кнопку
        if (chatForm.classList.contains('active')) {
            scrollToTopBtn.style.display = 'none';
        }
    });

    // Функция прокрутки вверх
    scrollToTopBtn.addEventListener('click', function() {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    });

    // Скрываем кнопку при открытии чата
    chatForm.addEventListener('click', function() {
        if (chatForm.classList.contains('active')) {
            scrollToTopBtn.style.display = 'none';
        } else if (window.pageYOffset > 300) {
            scrollToTopBtn.style.display = 'flex';
        }
    });
</script>
<script>
    // Исправленные функции для закрытия модальных окон
    function closeLoginModal() {
        document.getElementById("loginModal").style.display = "none";
    }

    function closeRegisterModal() {
        document.getElementById("registerModal").style.display = "none";
    }

    function closeCartModal() {
        document.getElementById("cartModal").style.display = "none";
        // Сбрасываем состояние оплаты при закрытии корзины
        document.getElementById('payment-success').style.display = 'none';
        document.querySelectorAll('.payment-option').forEach(option => {
            option.classList.remove('selected');
        });
        document.querySelectorAll('.payment-form').forEach(form => {
            form.classList.remove('active');
        });
        document.getElementById('payment-methods').style.display = 'none';
        document.getElementById('checkout-btn').style.display = 'block';
    }

    function closePrivacyModal() {
        document.getElementById("privacyModal").style.display = "none";
    }

    // Закрытие модального окна при клике вне его области
    window.onclick = function(event) {
        if (event.target == document.getElementById("loginModal")) {
            closeLoginModal();
        }
        if (event.target == document.getElementById("registerModal")) {
            closeRegisterModal();
        }
        if (event.target == document.getElementById("cartModal")) {
            closeCartModal();
        }
        if (event.target == document.getElementById("privacyModal")) {
            closePrivacyModal();
        }
    }
    
    // Закрытие модального окна при нажатии Esc
    document.onkeydown = function(event) {
        if (event.key === "Escape") {
            closeLoginModal();
            closeRegisterModal();
            closeCartModal();
            closePrivacyModal();
        }
    };
</script>

</body>
<div class="build-info">
    Build v1.0.0 - 2025.06.07
</div>

<style>
    .build-info {
        position: fixed;
        left: 10px;
        bottom: 10px;
        font-size: 10px;
        color: #999;
        z-index: 1000;
        background-color: rgba(0, 0, 0, 0.7);
        padding: 2px 5px;
        border-radius: 3px;
    }
</style>
<!-- Добавьте перед закрывающим тегом </body> -->
<div class="cat-game-button" id="caameButton">
    <img src="https://cdn-icons-png.flaticon.com/512/616/616408.png" alt="Кот" width="40" style="filter: grayscale(100%)">
</div>

<div class="game-modal" id="gameModal">
    <div class="game-container">
        <span class="close-game" onclick="closeGame()">&times;</span>
        <div class="games-menu">
            <h2>Мини-игры</h2>
            <div class="game-options">
                <div class="game-option" onclick="starame('cloud')">
                    <img src="https://cdn-icons-png.flaticon.com/512/1163/1163624.png" alt="Прыжки по облакам">
                    <h3>Прыжки по облакам</h3>
                </div>
                <div class="game-option" onclick="starame('tetris')">
                    <img src="https://cdn-icons-png.flaticon.com/512/2821/2821797.png" alt="Тетрис">
                    <h3>Тетрис</h3>
                </div>
                <div class="game-option" onclick="starame('tanks')">
                    <img src="https://cdn-icons-png.flaticon.com/512/3473/3473619.png" alt="Танчики">
                    <h3>Танчики</h3>
                </div>
            </div>
        </div>
        
        <div class="game-wrapper" id="gameWrapper" style="display: none;">
            <canvas id="gameCanvas" width="600" height="300"></canvas>
            <div class="game-controls">
                <button id="jumpBtn">Прыжок (Пробел)</button>
                <div class="score">Счет: <span id="score">0</span></div>
            </div>
        </div>
    </div>
</div>

<style>
    .cat-game-button {
        position: fixed;
        left: 15px;
        bottom: 15px;
        cursor: pointer;
        z-index: 1000;
        background: rgba(255,255,255,0.8);
        padding: 5px;
        border-radius: 50%;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        transition: transform 0.3s;
    }
    
    .cat-game-button:hover {
        transform: scale(1.1);
    }
    
    .cat-game-button img {
        display: block;
    }
    
    .game-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.8);
        z-index: 2000;
        justify-content: center;
        align-items: center;
    }
    
    .game-container {
        background: #000;
        padding: 20px;
        border-radius: 10px;
        position: relative;
        width: 80%;
        max-width: 800px;
    }
    
    .close-game {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 24px;
        color: #fff;
        cursor: pointer;
    }
    
    .games-menu {
        text-align: center;
        color: white;
    }
    
    .games-menu h2 {
        margin-bottom: 20px;
    }
    
    .game-options {
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        gap: 20px;
    }
    
    .game-option {
        cursor: pointer;
        background: #333;
        padding: 15px;
        border-radius: 10px;
        transition: transform 0.3s;
        width: 200px;
    }
    
    .game-option:hover {
        transform: scale(1.05);
        background: #444;
    }
    
    .game-option img {
        width: 100px;
        height: 100px;
        object-fit: contain;
        margin-bottom: 10px;
    }
    
    .game-option h3 {
        margin: 0;
        color: white;
    }
    
    .game-wrapper {
        position: relative;
    }
    
    #gameCanvas {
        background: #53c2ee;
        border: 2px solid #fff;
        display: block;
        margin: 0 auto;
        width: 100%;
    }
    
    .game-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 10px;
        padding: 0 10px;
        color: white;
    }
    
    #jumpBtn {
        background: #4CAF50;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 5px;
        cursor: pointer;
    }
    
    .score {
        color: white;
        font-weight: bold;
    }
</style>

<script>
    // Игровое меню
    const caameButton = document.getElementById('caameButton');
    const gameModal = document.getElementById('gameModal');
    const closeGameBtn = document.querySelector('.close-game');
    const gamesMenu = document.querySelector('.games-menu');
    const gameWrapper = document.getElementById('gameWrapper');
    let currename = null;
    
    // Открытие игрового меню
    caameButton.addEventListener('click', function() {
        gameModal.style.display = 'flex';
        gamesMenu.style.display = 'block';
        gameWrapper.style.display = 'none';
    });
    
    // Закрытие игры
    function closeGame() {
        gameModal.style.display = 'none';
        if (currename === 'cloud') {
            cancelAnimationFrame(cloudAnimationId);
        } else if (currename === 'tetris') {
            // Остановить игру в тетрис
        } else if (currename === 'tanks') {
            // Остановить игру в танчики
        }
    }
    
    // Закрытие при клике вне области игры
    gameModal.addEventListener('click', function(e) {
        if (e.target === gameModal) {
            closeGame();
        }
    });
    
    // Запуск выбранной игры
    function starame(gameType) {
        currename = gameType;
        gamesMenu.style.display = 'none';
        gameWrapper.style.display = 'block';
        
        if (gameType === 'cloud') {
            initCloudGame();
        } else if (gameType === 'tetris') {
            alert('Тетрис скоро будет доступен!');
            // initTetrisGame();
        } else if (gameType === 'tanks') {
            alert('Танчики скоро будут доступны!');
            // initTanksGame();
        }
    }
    
    // Вернуться в меню игр
    function backToMenu() {
        gamesMenu.style.display = 'block';
        gameWrapper.style.display = 'none';
        if (currename === 'cloud') {
            cancelAnimationFrame(cloudAnimationId);
        }
        currename = null;
    }
    
    // Добавьте кнопку "Назад" в game-controls
    const gameControls = document.querySelector('.game-controls');
    const backBtn = document.createElement('button');
    backBtn.textContent = 'Назад';
    backBtn.onclick = backToMenu;
    backBtn.style.marginRight = '10px';
    gameControls.insertBefore(backBtn, gameControls.firstChild);

    // Игра "Прыжки по облакам"
    let canvas, ctx, boy, clouds, obstacles, score, gravity, cloudAnimationId;
    let isJumping = false;
    let baseGameSpeed = 2; // Начальная скорость (медленная)
    let currentSpeed = baseGameSpeed;
    
    function initCloudGame() {
        canvas = document.getElementById('gameCanvas');
        ctx = canvas.getContext('2d');
        
        // Установим размеры canvas в зависимости от ширины контейнера
        canvas.width = document.querySelector('.game-container').clientWidth - 40;
        canvas.height = 300;
        
        // Игровые объекты
        boy = {
            x: 50,
            y: canvas.height - 60,
            width: 40,
            height: 60,
            dy: 0,
            jumpForce: -15,
            gravity: 0.8,
            color: '#3498db'
        };
        
        clouds = [];
        obstacles = [];
        score = 0;
        currentSpeed = baseGameSpeed;
        document.getElementById('score').textContent = '0';
        
        // Создаем начальные облака
        for (let i = 0; i < 5; i++) {
            clouds.push({
                x: Math.random() * canvas.width,
                y: Math.random() * (canvas.height - 100),
                width: 80 + Math.random() * 50,
                height: 30,
                speed: 1 + Math.random() * 2
            });
        }
        
        // Обработчики управления
        document.addEventListener('keydown', jump);
        document.getElementById('jumpBtn').addEventListener('click', jump);
        
        // Запуск игрового цикла
        cloudAnimationId = requestAnimationFrame(cloudGameLoop);
    }
    
    function jump(e) {
        // Прыжок только если не в прыжке и нажата пробел или кнопка
        if ((e.type === 'keydown' && e.code === 'Space') || e.type === 'click') {
            if (!isJumping) {
                boy.dy = boy.jumpForce;
                isJumping = true;
            }
            e.preventDefault();
        }
    }
    
    function cloudGameLoop() {
        // Очистка холста
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Обновление позиции мальчика
        boy.dy += boy.gravity;
        boy.y += boy.dy;
        
        // Проверка на землю
        if (boy.y > canvas.height - boy.height) {
            boy.y = canvas.height - boy.height;
            boy.dy = 0;
            isJumping = false;
        }
        
        // Обновление облаков
        for (let i = 0; i < clouds.length; i++) {
            clouds[i].x -= clouds[i].speed;
            
            // Если облако ушло за экран, перемещаем его вправо
            if (clouds[i].x + clouds[i].width < 0) {
                clouds[i].x = canvas.width;
                clouds[i].y = Math.random() * (canvas.height - 100);
            }
        }
        
        // Генерация препятствий
        if (Math.random() < 0.01) {
            obstacles.push({
                x: canvas.width,
                y: canvas.height - 40,
                width: 30,
                height: 40,
                speed: currentSpeed + Math.random() * 2
            });
        }
        
        // Обновление препятствий
        for (let i = 0; i < obstacles.length; i++) {
            obstacles[i].x -= obstacles[i].speed;
            
            // Проверка столкновений
            if (boy.x < obstacles[i].x + obstacles[i].width &&
                boy.x + boy.width > obstacles[i].x &&
                boy.y < obstacles[i].y + obstacles[i].height &&
                boy.y + boy.height > obstacles[i].y) {
                // Конец игры
                alert('Игра окончена! Ваш счет: ' + score);
                backToMenu();
                return;
            }
            
            // Удаление препятствий за экраном
            if (obstacles[i].x + obstacles[i].width < 0) {
                obstacles.splice(i, 1);
                i--;
                score++;
                document.getElementById('score').textContent = score;
                
                // Увеличиваем скорость каждые 5 очков
                if (score % 5 === 0) {
                    currentSpeed += 0.5;
                }
            }
        }
        
        // Отрисовка
        drawBoy();
        drawClouds();
        drawObstacles();
        
        // Продолжаем игровой цикл
        cloudAnimationId = requestAnimationFrame(cloudGameLoop);
    }
    
    function drawBoy() {
        // Тело
        ctx.fillStyle = boy.color;
        ctx.fillRect(boy.x, boy.y, boy.width, boy.height);
        
        // Голова
        ctx.beginPath();
        ctx.arc(boy.x + boy.width/2, boy.y - 15, 15, 0, Math.PI * 2);
        ctx.fillStyle = '#f1c40f';
        ctx.fill();
        
        // Глаза
        ctx.beginPath();
        ctx.arc(boy.x + boy.width/2 - 5, boy.y - 20, 3, 0, Math.PI * 2);
        ctx.arc(boy.x + boy.width/2 + 5, boy.y - 20, 3, 0, Math.PI * 2);
        ctx.fillStyle = '#000';
        ctx.fill();
        
        // Улыбка
        ctx.beginPath();
        ctx.arc(boy.x + boy.width/2, boy.y - 15, 8, 0.1 * Math.PI, 0.9 * Math.PI);
        ctx.strokeStyle = '#000';
        ctx.lineWidth = 2;
        ctx.stroke();
    }
    
    function drawClouds() {
        ctx.fillStyle = '#fff';
        for (let i = 0; i < clouds.length; i++) {
            // Основная часть облака
            ctx.beginPath();
            ctx.arc(clouds[i].x + clouds[i].width/4, clouds[i].y + clouds[i].height/2, clouds[i].height/2, 0, Math.PI * 2);
            ctx.arc(clouds[i].x + clouds[i].width/2, clouds[i].y + clouds[i].height/4, clouds[i].height/2, 0, Math.PI * 2);
            ctx.arc(clouds[i].x + 3*clouds[i].width/4, clouds[i].y + clouds[i].height/2, clouds[i].height/2, 0, Math.PI * 2);
            ctx.fill();
        }
    }
    
    function drawObstacles() {
        ctx.fillStyle = '#e74c3c';
        for (let i = 0; i < obstacles.length; i++) {
            // Основание
            ctx.fillRect(obstacles[i].x, obstacles[i].y, obstacles[i].width, obstacles[i].height);
            
            // Верхняя часть
            ctx.beginPath();
            ctx.arc(obstacles[i].x + obstacles[i].width/2, obstacles[i].y, obstacles[i].width/2, 0, Math.PI);
            ctx.fill();
        }
    }
</script>
<script>
    // ========== ТЕТРИС ==========
    const COLS = 5;
    const ROWS = 5;
    const BLOCK_SIZE = 20; // Восстановил нормальный размер блока
    const COLORS = [
        '#00FFFF', '#0000FF', '#FFA500', '#FFFF00', '#00FF00', '#800080', '#FF0000'
    ];
    
    // Уменьшенные фигуры тетриса (2x2 и 3x3 вместо 4x4)
    const SHAPES = [
        [[1, 1, 1]],                          // I (теперь 1x3)
        [[2, 0], [2, 2]],                     // J (2x2)
        [[0, 3], [3, 3]],                     // L (2x2)
        [[4, 4], [4, 4]],                     // O (2x2)
        [[0, 5, 5], [5, 5, 0]],               // S (2x3)
        [[0, 6, 0], [6, 6, 6]],               // T (2x3)
        [[7, 7, 0], [0, 7, 7]]                // Z (2x3)
    ];
    
    let tetrisCanvas, tetrisCtx;
    let board = [];
    let currentPiece, nextPiece;
    let sscore = 0;
    let level = 1;
    let lines = 0;
    let gameOver = false;
    let dropStart;
    let tetrisAnimationId;
    let gameInterval;
    
    function initTetrisGame() {
        tetrisCanvas = document.getElementById('gameCanvas');
        tetrisCtx = tetrisCanvas.getContext('2d');
        
        // Установка размера canvas
        tetrisCanvas.width = COLS * BLOCK_SIZE;
        tetrisCanvas.height = ROWS * BLOCK_SIZE;
        
        // Инициализация игрового поля
        initBoard();
        
        // Создание первой фигуры
        currentPiece = randomPiece();
        nextPiece = randomPiece();
        
        // Сброс счетчиков
        sscore = 0;
        level = 1;
        lines = 0;
        gameOver = false;
        document.getElementById('score').textContent = '0';
        
        // Запуск игрового цикла
        dropStart = Date.now();
        gameInterval = setInterval(moveDown, 1000);
        
        // Обработчики управления
        document.addEventListener('keydown', control);
        
        // Первая отрисовка
        draw();
    }
    
    function initBoard() {
        board = [];
        for (let r = 0; r < ROWS; r++) {
            board[r] = [];
            for (let c = 0; c < COLS; c++) {
                board[r][c] = 0;
            }
        }
    }
    
    function randomPiece() {
        const randomIndex = Math.floor(Math.random() * SHAPES.length);
        const shape = SHAPES[randomIndex];
        const color = COLORS[randomIndex];
        
        // Центрирование фигуры с учетом ее размера
        const piece = {
            shape: shape,
            color: color,
            x: Math.max(0, Math.floor(COLS / 2) - Math.floor(shape[0].length / 2)),
            y: 0
        };
        
        return piece;
    }
    
    function drawBlock(x, y, color) {
        tetrisCtx.fillStyle = color;
        tetrisCtx.fillRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
        
        tetrisCtx.strokeStyle = '#000';
        tetrisCtx.strokeRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
    }
    
    function drawBoard() {
        for (let r = 0; r < ROWS; r++) {
            for (let c = 0; c < COLS; c++) {
                if (board[r][c]) {
                    drawBlock(c, r, COLORS[board[r][c] - 1]);
                }
            }
        }
    }
    
    function drawPiece() {
        for (let r = 0; r < currentPiece.shape.length; r++) {
            for (let c = 0; c < currentPiece.shape[r].length; c++) {
                if (currentPiece.shape[r][c]) {
                    drawBlock(currentPiece.x + c, currentPiece.y + r, currentPiece.color);
                }
            }
        }
    }
    
    function draw() {
        tetrisCtx.clearRect(0, 0, tetrisCanvas.width, tetrisCanvas.height);
        drawBoard();
        drawPiece();
    }
    
    function control(e) {
        if (gameOver) return;
        
        switch(e.keyCode) {
            case 37: // LEFT
                if (!collision(-1, 0, currentPiece.shape)) {
                    currentPiece.x--;
                    draw();
                }
                break;
            case 38: // UP
                const rotated = rotate(currentPiece.shape);
                if (!collision(0, 0, rotated)) {
                    currentPiece.shape = rotated;
                    draw();
                }
                break;
            case 39: // RIGHT
                if (!collision(1, 0, currentPiece.shape)) {
                    currentPiece.x++;
                    draw();
                }
                break;
            case 40: // DOWN
                if (!collision(0, 1, currentPiece.shape)) {
                    currentPiece.y++;
                    draw();
                }
                break;
            case 32: // SPACE
                while (!collision(0, 1, currentPiece.shape)) {
                    currentPiece.y++;
                }
                draw();
                lock();
                break;
        }
    }
    
    function rotate(shape) {
        const N = shape.length;
        const rotated = [];
        
        for (let i = 0; i < N; i++) {
            rotated[i] = [];
            for (let j = 0; j < N; j++) {
                rotated[i][j] = shape[N - j - 1][i];
            }
        }
        
        return rotated;
    }
    
    function collision(offsetX, offsetY, piece) {
        for (let r = 0; r < piece.length; r++) {
            for (let c = 0; c < piece[r].length; c++) {
                if (!piece[r][c]) continue;
                
                const newX = currentPiece.x + c + offsetX;
                const newY = currentPiece.y + r + offsetY;
                
                if (newX < 0 || newX >= COLS || newY >= ROWS) {
                    return true;
                }
                
                if (newY < 0) continue;
                
                if (board[newY][newX]) {
                    return true;
                }
            }
        }
        return false;
    }
    
    function lock() {
        for (let r = 0; r < currentPiece.shape.length; r++) {
            for (let c = 0; c < currentPiece.shape[r].length; c++) {
                if (!currentPiece.shape[r][c]) continue;
                
                if (currentPiece.y + r < 0) {
                    gameOver = true;
                    alert('Игра окончена! Ваш счет: ' + sscore);
                    clearInterval(gameInterval);
                    backToMenu();
                    return;
                }
                
                board[currentPiece.y + r][currentPiece.x + c] = 
                    COLORS.indexOf(currentPiece.color) + 1;
            }
        }
        
        // Проверка заполненных строк
        checkRows();
        
        // Новая фигура
        currentPiece = nextPiece;
        nextPiece = randomPiece();
        
        // Проверка столкновения сразу после появления новой фигуры
        if (collision(0, 0, currentPiece.shape)) {
            gameOver = true;
            alert('Игра окончена! Ваш счет: ' + sscore);
            clearInterval(gameInterval);
            backToMenu();
            return;
        }
        
        // Сброс таймера
        dropStart = Date.now();
    }
    
    function checkRows() {
        let rowsCleared = 0;
        
        for (let r = ROWS - 1; r >= 0; r--) {
            let isRowFull = true;
            
            for (let c = 0; c < COLS; c++) {
                if (board[r][c] === 0) {
                    isRowFull = false;
                    break;
                }
            }
            
            if (isRowFull) {
                // Удаление строки
                for (let y = r; y > 0; y--) {
                    for (let c = 0; c < COLS; c++) {
                        board[y][c] = board[y - 1][c];
                    }
                }
                
                // Очистка верхней строки
                for (let c = 0; c < COLS; c++) {
                    board[0][c] = 0;
                }
                
                rowsCleared++;
                r++; // Проверяем эту же строку снова
            }
        }
        
        if (rowsCleared > 0) {
            // Обновление счета
            updateScore(rowsCleared);
        }
    }
    
    function updateScore(linesCleared) {
        const points = [0, 40, 100, 300, 1200]; // Очки за 0, 1, 2, 3, 4 линии
        sscore += points[linesCleared] * level;
        lines += linesCleared;
        
        // Каждые 10 линий - новый уровень (максимальная скорость 100ms)
        const newLevel = Math.floor(lines / 10) + 1;
        if (newLevel > level) {
            level = newLevel;
            clearInterval(gameInterval);
            gameInterval = setInterval(moveDown, Math.max(100, 1000 - (level - 1) * 100));
        }
        
        document.getElementById('score').textContent = sscore;
    }
    
    function moveDown() {
        if (!collision(0, 1, currentPiece.shape)) {
            currentPiece.y++;
            draw();
        } else {
            lock();
        }
    }
    
    // Обновляем функцию starame для поддержки тетриса
    function starame(gameType) {
        currename = gameType;
        gamesMenu.style.display = 'none';
        gameWrapper.style.display = 'block';
        
        // Очистка предыдущих обработчиков
        document.removeEventListener('keydown', control);
        document.removeEventListener('keydown', jump);
        
        if (gameType === 'cloud') {
            initCloudGame();
        } else if (gameType === 'tetris') {
            initTetrisGame();
        } else if (gameType === 'tanks') {
            alert('Танчики скоро будут доступны!');
        }
    }
</script>
</html>